{
	"name": "02_generate_UPL",
	"properties": {
		"content": {
			"query": "-- drop PROCEDURE [dbo].[sp_GenerateUPL]\n\nCREATE PROCEDURE [dbo].[sp_GenerateUPL]\n    @ContainerName NVARCHAR(100),\n    @CYDate NVARCHAR(10),\n    @PYDate NVARCHAR(10)\nAS\nBEGIN\n    SET NOCOUNT ON;\n\n    DECLARE @sql NVARCHAR(MAX);\n\n    -- Drop table if exists for CYDate\n    SET @sql = '\n    IF OBJECT_ID(''[dbo].[' + @ContainerName + '_UPL_' + @CYDate + ']'', ''U'') IS NOT NULL\n        DROP TABLE [dbo].[' + @ContainerName + '_UPL_' + @CYDate + '];';\n    EXEC sp_executesql @sql;\n\n    -- Create table for CYDate\n    SET @sql = '\n    SELECT  \n        ''31/12/2024'' AS [Ref_Date],\n        [acc_id],\n        [product],\n        [balance],\n        [interest]\n    INTO [dbo].[' + @ContainerName + '_UPL_' + @CYDate + ']\n    FROM [dbo].[Balance_' + @CYDate + '];';\n\n    EXEC sp_executesql @sql;\n\n    -- Drop table for PYDate if exists\n    SET @sql = '\n    IF OBJECT_ID(''[dbo].[' + @ContainerName + '_UPL_' + @PYDate + ']'', ''U'') IS NOT NULL\n        DROP TABLE [dbo].[' + @ContainerName + '_UPL_' + @PYDate + '];';\n\n    EXEC sp_executesql @sql;\n\n    -- Create table for PYDate\n    SET @sql = '\n    SELECT\n        ''31/12/2023'' AS [Ref_Date],\n        [acc_id],\n        [product],\n        [balance],\n        [interest]\n    INTO [dbo].[' + @ContainerName + '_UPL_' + @PYDate + ']\n    FROM [dbo].[Balance_' + @PYDate + '];';\n\n    EXEC sp_executesql @sql;\n\nEND;\n\nEXEC [dbo].[sp_GenerateUPL]\n    @ContainerName = 'creations',\n    @CYDate = '202412',\n    @PYDate = '202312';\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "sourabhdb",
				"poolName": "sourabhdb"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}